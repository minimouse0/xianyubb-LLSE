"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
const path_1 = require("path");
const fs_1 = require("fs");
const child_process_1 = require("child_process");
const env_paths_1 = __importDefault(require("env-paths"));
function gocq(options = {}) {
    const args = [];
    if (!(0, fs_1.existsSync)(gocq.binary)) {
        (0, fs_1.mkdirSync)((0, path_1.dirname)(gocq.binary), { recursive: true });
        (0, fs_1.copyFileSync)(gocq.backup, gocq.binary);
    }
    if (options.faststart)
        args.push('-faststart');
    if (options.signServer)
        args.push('-sign-server', options.signServer);
    return (0, child_process_1.spawn)(gocq.binary, args, {
        env: {
            FORCE_TTY: '1',
            ...process.env,
            ...options.env,
        },
        ...options,
    });
}
(function (gocq) {
    gocq.version = 'v1.0.1';
    gocq.runId = null;
    gocq.basename = 'go-cqhttp' + (process.platform === 'win32' ? '.exe' : '');
    gocq.binary = (0, path_1.resolve)((0, env_paths_1.default)('gocqhttp').data, gocq.version, gocq.basename);
    gocq.backup = (0, path_1.resolve)(__dirname, '../bin', gocq.basename);
})(gocq || (gocq = {}));
module.exports = gocq;
